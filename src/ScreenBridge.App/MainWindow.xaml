<ui:FluentWindow x:Class="ScreenBridge.App.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
        xmlns:tb="http://www.hardcodet.net/taskbar"
        xmlns:local="clr-namespace:ScreenBridge.App"
        mc:Ignorable="d"
        Title="ScreenBridge" 
        Height="Auto" Width="800"
        MinHeight="500" MinWidth="700"
        SizeToContent="Height" ResizeMode="CanResize"
        WindowStartupLocation="CenterScreen"
        ExtendsContentIntoTitleBar="True"
        WindowBackdropType="Mica"
        StateChanged="FluentWindow_StateChanged">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- 标题栏 -->
        <ui:TitleBar Grid.Row="0" Title="ScreenBridge" ShowMaximize="True" ShowMinimize="True"/>

        <!-- 主内容区域 -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
            <Grid Margin="24" VerticalAlignment="Top">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

            <!-- 当前模式状态卡片 -->
            <ui:Card Grid.Row="0" Margin="0,0,0,16">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <Border Grid.Column="0" 
                            x:Name="ModeIconBorder"
                            Width="72" Height="72" 
                            CornerRadius="12" 
                            Background="Transparent"
                            Margin="0,0,16,0">
                        <ui:SymbolIcon x:Name="ModeIcon" 
                                       Symbol="Desktop24"
                                       FontSize="48"
                                       Foreground="Gray"/>
                    </Border>

                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                        <TextBlock x:Name="ModeTitle" Text="Windows 模式" FontSize="20" FontWeight="SemiBold"/>
                        <TextBlock x:Name="ModeDescription" Text="主显示器用于 Windows，音频输出到主显示器" 
                                   Foreground="{ui:ThemeResource TextFillColorSecondaryBrush}" 
                                   Margin="0,4,0,0"/>
                        <TextBlock x:Name="WindowRuleStatus" Text="窗口规则: 默认" 
                                   FontSize="12"
                                   Foreground="{ui:ThemeResource TextFillColorTertiaryBrush}" 
                                   Margin="0,2,0,0"/>
                    </StackPanel>

                    <StackPanel Grid.Column="2" VerticalAlignment="Center">
                        <ui:Button x:Name="SwitchModeButton"
                                   Content="切换到 PS5 模式" 
                                   Appearance="Primary"
                                   Click="SwitchModeButton_Click"
                                   Width="160" Margin="0,0,0,8"/>

                        <ui:Button Content="打开窗口概览" 
                                   Appearance="Secondary"
                                   Click="OpenOverviewButton_Click"
                                   Width="160">
                            <ui:Button.Icon>
                                <ui:SymbolIcon Symbol="WindowApps24"/>
                            </ui:Button.Icon>
                        </ui:Button>
                    </StackPanel>
                </Grid>
            </ui:Card>

            <!-- 音频设备设置 -->
            <ui:Card Grid.Row="1" Margin="0,0,0,16">
                <Expander Header="🔊 音频设备设置" IsExpanded="True">
                    <StackPanel Margin="0,16,0,0">
                        <!-- 当前活动的音频设备 -->
                        <Grid Margin="0,0,0,16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="150"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="当前活动设备:" VerticalAlignment="Center" FontWeight="SemiBold"/>
                            <TextBlock Grid.Column="1" x:Name="CurrentAudioDeviceText" 
                                       Text="正在获取..." VerticalAlignment="Center"
                                       FontWeight="Bold"
                                       Foreground="{ui:ThemeResource TextFillColorPrimaryBrush}"/>
                        </Grid>

                        <!-- 音量滑块 -->
                        <Grid Margin="0,0,0,16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="150"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="50"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="音量:" VerticalAlignment="Center"/>
                            <Slider Grid.Column="1" x:Name="VolumeSlider" 
                                    Minimum="0" Maximum="100" 
                                    IsMoveToPointEnabled="True"
                                    TickFrequency="1"
                                    VerticalAlignment="Center"
                                    ValueChanged="VolumeSlider_ValueChanged"/>
                            <TextBlock Grid.Column="2" x:Name="VolumeText" 
                                       Text="0%" Margin="8,0,0,0" 
                                       VerticalAlignment="Center"/>
                        </Grid>
                        

                    </StackPanel>
                </Expander>
            </ui:Card>

            <!-- 热键设置 -->
            <ui:Card Grid.Row="2" Margin="0,0,0,16">
                <Expander Header="⌨️ 快捷键设置">
                    <StackPanel Margin="0,16,0,0">
                        <Grid Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="150"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="切换模式:" VerticalAlignment="Center"/>
                            <ui:TextBox Grid.Column="1" x:Name="SwitchHotkeyTextBox" 
                                        Text="Ctrl + Alt + S" IsReadOnly="True" Margin="8,0,0,0"/>
                        </Grid>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="150"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="窗口概览:" VerticalAlignment="Center"/>
                            <ui:TextBox Grid.Column="1" x:Name="OverviewHotkeyTextBox" 
                                        Text="Ctrl + Alt + W" IsReadOnly="True" Margin="8,0,0,0"/>
                        </Grid>
                    </StackPanel>
                </Expander>
            </ui:Card>

            <!-- 显示器信息 -->
            <ui:Card Grid.Row="3" Margin="0,0,0,16">
                <Expander Header="🖥️ 显示器信息">
                    <StackPanel x:Name="MonitorInfoPanel" Margin="0,16,0,0">
                        <!-- 动态生成 -->
                    </StackPanel>
                </Expander>
            </ui:Card>

            <!-- 底部设置与规则按钮 -->
            <Grid Grid.Row="4" Margin="0,16,0,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <ui:ToggleSwitch x:Name="AutoStartToggle" Content="开机自启动" Margin="0,0,24,0" 
                                     Checked="AutoStartToggle_Checked" Unchecked="AutoStartToggle_Unchecked"/>
                    <ui:ToggleSwitch x:Name="DDCAutoDetectToggle" Content="DDC/CI 自动检测" 
                                     Checked="DDCAutoDetectToggle_Checked" Unchecked="DDCAutoDetectToggle_Unchecked"/>
                </StackPanel>

                <ui:Button Grid.Column="1" Content="配置规则..." Appearance="Secondary" 
                           Click="ConfigureRulesButton_Click">
                    <ui:Button.Icon>
                        <ui:SymbolIcon Symbol="Settings24"/>
                    </ui:Button.Icon>
                </ui:Button>
            </Grid>
        </Grid>
        
        <!-- 系统托盘图标 -->

        </ScrollViewer>
        <tb:TaskbarIcon x:Name="TrayIcon"
                        ToolTipText="ScreenBridge"
                        TrayLeftMouseDoubleClick="TrayShow_Click">
            <tb:TaskbarIcon.ContextMenu>
                <ContextMenu>
                    <MenuItem Header="📺 显示主窗口" Click="TrayShow_Click"/>
                    <Separator/>
                    <MenuItem Header="🖥️ 切换到 Windows 模式" Click="TrayWindowsMode_Click"/>
                    <MenuItem Header="🎮 切换到 PS5 模式" Click="TrayPS5Mode_Click"/>
                    <Separator/>
                    <MenuItem Header="❌ 退出" Click="TrayExit_Click"/>
                </ContextMenu>
            </tb:TaskbarIcon.ContextMenu>
        </tb:TaskbarIcon>
    </Grid>
</ui:FluentWindow>
