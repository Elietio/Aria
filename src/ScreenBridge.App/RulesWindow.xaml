<ui:FluentWindow x:Class="ScreenBridge.App.RulesWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
        mc:Ignorable="d"
        Title="è§„åˆ™é…ç½®" Height="600" Width="500"
        WindowStartupLocation="CenterOwner" ResizeMode="NoResize"
        ExtendsContentIntoTitleBar="True">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <ui:TitleBar Title="è§„åˆ™é…ç½®" Grid.Row="0"/>

        <ScrollViewer Grid.Row="1" Padding="20">
            <StackPanel>
                
                <!-- DDC æ£€æµ‹è®¾ç½® -->
                <ui:CardExpander Header="ðŸ” æ£€æµ‹è®¾ç½®" IsExpanded="True" Margin="0,0,0,10">
                    <StackPanel>
                        <TextBlock Text="é€‰æ‹©è¦ç›‘æŽ§è¾“å…¥ä¿¡å·çš„æ˜¾ç¤ºå™¨ï¼š" Foreground="{DynamicResource TextFillColorSecondaryBrush}" Margin="0,0,0,10"/>
                        <ComboBox x:Name="DDCMonitorCombo" DisplayMemberPath="FriendlyName" Margin="0,0,0,10"/>
                        <TextBlock Text="ç¨‹åºä¼šæŒç»­æ£€æµ‹è¿™å°æ˜¾ç¤ºå™¨çš„è¾“å…¥æºå˜åŒ–ï¼Œä»¥è§¦å‘æ¨¡å¼åˆ‡æ¢ã€‚" 
                                   FontSize="12" Foreground="{DynamicResource TextFillColorTertiaryBrush}" TextWrapping="Wrap" Margin="0,0,0,10"/>
                        
                        <TextBlock Text="å½“ DDC ä¿¡å·ä¸¢å¤±æ—¶çš„è¡Œä¸º (å…¼å®¹ LG):" FontSize="12" Margin="0,0,0,5"/>
                        <ComboBox x:Name="DdcLossActionCombo" Margin="0,0,0,10">
                            <ComboBoxItem Content="åˆ‡æ¢åˆ° PS5 æ¨¡å¼ (æŽ¨è)" Tag="SwitchToModeB"/>
                            <ComboBoxItem Content="åˆ‡æ¢åˆ° Windows æ¨¡å¼" Tag="SwitchToModeA"/>
                            <ComboBoxItem Content="ä¿æŒå½“å‰æ¨¡å¼ (ä¸åˆ‡æ¢)" Tag="DoNothing"/>
                        </ComboBox>

                        <Grid>
                             <Grid.ColumnDefinitions>
                                 <ColumnDefinition Width="Auto"/>
                                 <ColumnDefinition Width="*"/>
                             </Grid.ColumnDefinitions>
                             <TextBlock Text="å½“å‰ä¾¦æµ‹å€¼:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                             <TextBlock x:Name="DDCReadoutText" Text="è¯»å–ä¸­..." 
                                        FontWeight="Bold" Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                        VerticalAlignment="Center" Grid.Column="1"/>
                        </Grid>
                        <ui:Button Content="åˆ·æ–°è¯»å–" Appearance="Secondary" FontSize="12" 
                                   Margin="0,8,0,0" Padding="8,4" HorizontalAlignment="Left"
                                   Click="RefreshDDCReadout_Click"/>
                    </StackPanel>
                </ui:CardExpander>

                <!-- å¤–è§‚è®¾ç½® -->
                <ui:CardExpander Header="ðŸŽ¨ å¤–è§‚è®¾ç½®" IsExpanded="True" Margin="0,0,0,10">
                    <StackPanel>
                        <TextBlock Text="ç•Œé¢é£Žæ ¼:" Margin="0,0,0,5"/>
                        <ComboBox x:Name="ThemeCombo" Margin="0,0,0,10">
                            <ComboBoxItem Content="ç»å…¸é£Žæ ¼ (Classic)" Tag="Classic"/>
                            <ComboBoxItem Content="æ ‡å‡†èŒç³» (Moe Glass)" Tag="MoeGlass"/>
                            <ComboBoxItem Content="æžç®€èŒç³» (Moe Clean)" Tag="MoeClean"/>
                        </ComboBox>

                        <CheckBox x:Name="MascotToggle" Content="å¯ç”¨çœ‹æ¿å¨˜ç«‹ç»˜" Margin="0,0,0,10" Checked="MascotToggle_CheckedChanged" Unchecked="MascotToggle_CheckedChanged"/>
                        
                        <!-- çœ‹æ¿å¨˜é€æ˜Žåº¦æ»‘å— -->
                        <Grid x:Name="MascotOpacityPanel" Margin="20,0,0,10" Visibility="Collapsed">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="40"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="ç«‹ç»˜é€æ˜Žåº¦:" VerticalAlignment="Center" Margin="0,0,10,0" FontSize="12"/>
                            <Slider x:Name="MascotOpacitySlider" Grid.Column="1" 
                                    Minimum="0.01" Maximum="1.0" TickFrequency="0.01" 
                                    IsMoveToPointEnabled="True" VerticalAlignment="Center" 
                                    ValueChanged="MascotOpacitySlider_ValueChanged"/>
                            <TextBlock x:Name="MascotOpacityValueText" Grid.Column="2" 
                                       Text="75%" HorizontalAlignment="Right" VerticalAlignment="Center" 
                                       FontSize="12" Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                        </Grid>

                        <CheckBox x:Name="VoiceToggle" Content="å¯ç”¨çœ‹æ¿å¨˜è¯­éŸ³" Margin="0,0,0,10"/>
                        
                        <TextBlock Text="èƒŒæ™¯æè´¨:" Margin="0,0,0,5"/>
                        <ComboBox x:Name="BackdropCombo" Margin="0,0,0,10">
                            <ComboBoxItem Content="äº‘æ¯ Mica (å¾®å¦™)" Tag="Mica"/>
                            <ComboBoxItem Content="äºšå…‹åŠ› Acrylic (é€æ˜Ž)" Tag="Acrylic"/>
                        </ComboBox>
                        
                        <!-- é€æ˜Žåº¦æ»‘å— -->
                        <Grid x:Name="OpacityControlPanel" Margin="0,0,0,5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="40"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="èƒŒæ™¯ä¸é€æ˜Žåº¦:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                            <Slider x:Name="OpacitySlider" Grid.Column="1" 
                                    Minimum="0.01" Maximum="1.0" TickFrequency="0.01" 
                                    IsMoveToPointEnabled="True" VerticalAlignment="Center" 
                                    ValueChanged="OpacitySlider_ValueChanged"/>
                            <TextBlock x:Name="OpacityValueText" Grid.Column="2" 
                                       Text="5%" HorizontalAlignment="Right" VerticalAlignment="Center" 
                                       Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                        </Grid>
                        
                        <TextBlock Text="èŒç³»é£Žæ ¼åŒ…å«åŠ¨æ€è§’è‰²å¤´åƒã€ä¸»é¢˜é…è‰²åŠé€æ˜Žæ‰˜ç›˜å›¾æ ‡ã€‚" 
                                   FontSize="12" Foreground="{DynamicResource TextFillColorTertiaryBrush}" TextWrapping="Wrap"/>
                    </StackPanel>
                </ui:CardExpander>

                <!-- æ¨¡å¼ A è®¾ç½® -->
                <ui:CardExpander Header="ðŸ–¥ï¸ æ¨¡å¼ A (Windows)" IsExpanded="True" Margin="0,0,0,10">
                    <StackPanel>
                        <TextBlock Text="æ¨¡å¼åç§°:" Margin="0,0,0,5"/>
                        <ui:TextBox x:Name="ModeAName" PlaceholderText="ä¾‹å¦‚: Windows åŠžå…¬æ¨¡å¼" Margin="0,0,0,10"/>
                        
                        <Label Content="è§¦å‘æ¡ä»¶ (VCP è¾“å…¥ç ):"/>
                        <StackPanel x:Name="ModeATriggersPanel" Orientation="Vertical" Margin="0,0,0,10"/>
                        <TextBlock Text="æç¤º: DP=15, HDMI1=17, USB-C=27" FontSize="11" Foreground="{DynamicResource TextFillColorTertiaryBrush}" Margin="0,0,0,10"/>

                        <Label Content="æ¿€æ´»æ—¶åŠ¨ä½œ:"/>
                        <TextBlock Text="åˆ‡æ¢éŸ³é¢‘è®¾å¤‡:" FontSize="12"/>
                        <ComboBox x:Name="ModeAAudioCombo" DisplayMemberPath="Name" Margin="0,0,0,10"/>
                        
                        <TextBlock Text="æ–°çª—å£ç§»åŠ¨åˆ°:" FontSize="12"/>
                        <ComboBox x:Name="ModeAWindowCombo" Margin="0,0,0,10"/>

                        <TextBlock Text="ç¨‹åºçª—å£ç§»åŠ¨åˆ°:" FontSize="12"/>
                        <ComboBox x:Name="ModeAAppWindowCombo" Margin="0,0,0,10"/>
                    </StackPanel>
                </ui:CardExpander>

                <!-- æ¨¡å¼ B è®¾ç½® -->
                <ui:CardExpander Header="ðŸŽ® æ¨¡å¼ B (PS5)" IsExpanded="False" Margin="0,0,0,10">
                    <StackPanel>
                        <TextBlock Text="æ¨¡å¼åç§°:" Margin="0,0,0,5"/>
                        <ui:TextBox x:Name="ModeBName" PlaceholderText="ä¾‹å¦‚: PS5 æ¸¸æˆæ¨¡å¼" Margin="0,0,0,10"/>

                        <Label Content="è§¦å‘æ¡ä»¶ (VCP è¾“å…¥ç ):"/>
                        <StackPanel x:Name="ModeBTriggersPanel" Orientation="Vertical" Margin="0,0,0,10"/>
                        
                        <Label Content="æ¿€æ´»æ—¶åŠ¨ä½œ:"/>
                        <TextBlock Text="åˆ‡æ¢éŸ³é¢‘è®¾å¤‡:" FontSize="12"/>
                        <ComboBox x:Name="ModeBAudioCombo" DisplayMemberPath="Name" Margin="0,0,0,10"/>

                        <TextBlock Text="æ–°çª—å£ç§»åŠ¨åˆ°:" FontSize="12"/>
                        <ComboBox x:Name="ModeBWindowCombo" Margin="0,0,0,10"/>

                        <TextBlock Text="ç¨‹åºçª—å£ç§»åŠ¨åˆ°:" FontSize="12"/>
                        <ComboBox x:Name="ModeBAppWindowCombo" Margin="0,0,0,10"/>
                    </StackPanel>
                </ui:CardExpander>

                <!-- çƒ­é”®è®¾ç½® -->
                <ui:CardExpander Header="âŒ¨ï¸ å¿«æ·é”®è®¾ç½®" IsExpanded="False" Margin="0,0,0,10">
                    <StackPanel>
                        <TextBlock Text="ç‚¹å‡»è¾“å…¥æ¡†åŽæŒ‰ä¸‹æ–°çš„å¿«æ·é”®ç»„åˆæ¥æ›´æ”¹çƒ­é”®" 
                                   Foreground="{DynamicResource TextFillColorSecondaryBrush}" 
                                   FontSize="12" TextWrapping="Wrap" Margin="0,0,0,15"/>
                        
                        <!-- åˆ‡æ¢æ¨¡å¼çƒ­é”® -->
                        <Grid Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="120"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="åˆ‡æ¢æ¨¡å¼:" VerticalAlignment="Center"/>
                            <TextBox x:Name="SwitchModeHotkeyBox" Grid.Column="1" 
                                     IsReadOnly="True" 
                                     PreviewKeyDown="HotkeyBox_PreviewKeyDown"
                                     GotFocus="HotkeyBox_GotFocus"
                                     LostFocus="HotkeyBox_LostFocus"
                                     Tag="SwitchMode"
                                     Margin="0,0,8,0"/>
                            <ui:Button Grid.Column="2" Content="é‡ç½®" Appearance="Secondary" 
                                        Padding="8,4" Click="ResetHotkey_Click" Tag="SwitchMode"/>
                        </Grid>

                        <!-- çª—å£æ¦‚è§ˆçƒ­é”® -->
                        <Grid Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="120"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="çª—å£æ¦‚è§ˆ:" VerticalAlignment="Center"/>
                            <TextBox x:Name="WindowOverviewHotkeyBox" Grid.Column="1" 
                                     IsReadOnly="True"
                                     PreviewKeyDown="HotkeyBox_PreviewKeyDown"
                                     GotFocus="HotkeyBox_GotFocus"
                                     LostFocus="HotkeyBox_LostFocus"
                                     Tag="WindowOverview"
                                     Margin="0,0,8,0"/>
                            <ui:Button Grid.Column="2" Content="é‡ç½®" Appearance="Secondary"
                                        Padding="8,4" Click="ResetHotkey_Click" Tag="WindowOverview"/>
                        </Grid>

                        <TextBlock x:Name="HotkeyConflictWarning" 
                                   Text="" Foreground="Orange" FontSize="12" 
                                   TextWrapping="Wrap" Visibility="Collapsed" Margin="0,5,0,0"/>
                    </StackPanel>
                </ui:CardExpander>

                <!-- é€šçŸ¥è®¾ç½® -->
                <ui:CardExpander Header="ðŸ”” é€šçŸ¥è®¾ç½®" IsExpanded="False" Margin="0,0,0,10">
                    <StackPanel>
                        <ui:ToggleSwitch x:Name="EnableToastToggle" Content="æ¨¡å¼åˆ‡æ¢æ—¶æ˜¾ç¤º Toast é€šçŸ¥"/>
                    </StackPanel>
                </ui:CardExpander>

            </StackPanel>
        </ScrollViewer>

        <!-- åº•éƒ¨æŒ‰é’® -->
        <Border Grid.Row="2" Background="{DynamicResource SolidBackgroundFillColorSecondaryBrush}" Padding="20,10">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <ui:Button Content="å–æ¶ˆ" Appearance="Secondary" Click="CancelButton_Click" Width="80" Margin="0,0,10,0"/>
                <ui:Button Content="ä¿å­˜" Appearance="Primary" Click="SaveButton_Click" Width="80"/>
            </StackPanel>
        </Border>
    </Grid>
</ui:FluentWindow>
